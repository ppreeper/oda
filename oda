#!/usr/bin/env bash
# This script was generated by bashly 1.0.5 (https://bashly.dannyb.co)
# Modifying it manually is not recommended

# :wrapper.bash3_bouncer
if [[ "${BASH_VERSINFO:-0}" -lt 4 ]]; then
	printf "bash version 4 or higher is required\n" >&2
	exit 1
fi

# :command.master_script

# :command.version_command
version_command() {
	echo "$version"
}

# :command.usage
oda_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda - Odoo Administration Tool\n"
		echo

	else
		printf "oda - Odoo Administration Tool\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda COMMAND\n"
	printf "  oda [COMMAND] --help | -h\n"
	printf "  oda --version | -v\n"
	echo
	# :command.usage_commands
	printf "%s\n" "Commands:"
	printf "  %s   Start the instance\n" "start   "
	printf "  %s   Stop the instance\n" "stop    "
	printf "  %s   Restart the instance\n" "restart "
	printf "  %s   Follow the logs\n" "logs    "
	printf "  %s   Generates an Odoo module skeleton in addons\n" "scaffold"
	printf "  %s   initialize the database\n" "init    "
	printf "  %s   Install module(s)\n" "install "
	printf "  %s   Upgrade module(s)\n" "upgrade "
	printf "  %s   Access the raw database\n" "psql    "
	printf "  %s   Backup database filestore and addons\n" "backup  "
	printf "  %s   Restore database and filestore or addons\n" "restore "
	printf "  %s   Project level commands [CAUTION]\n" "project "
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo
		printf "  %s\n" "--version, -v"
		printf "    Show version number\n"
		echo

		# :command.usage_environment_variables
		printf "%s\n" "Environment Variables:"

		# :environment_variable.usage
		printf "  %s\n" "POD"
		printf "    Odoo instance\n"
		printf "    Default: ${PWD##*/}\n"
		echo

	fi
}

# :command.usage
oda_start_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda start - Start the instance\n"
		echo

	else
		printf "oda start - Start the instance\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda start\n"
	printf "  oda start --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda start\n"
		echo

	fi
}

# :command.usage
oda_stop_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda stop - Stop the instance\n"
		echo

	else
		printf "oda stop - Stop the instance\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda stop\n"
	printf "  oda stop --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda stop\n"
		echo

	fi
}

# :command.usage
oda_restart_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda restart - Restart the instance\n"
		echo

	else
		printf "oda restart - Restart the instance\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda restart\n"
	printf "  oda restart --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda stop\n"
		echo

	fi
}

# :command.usage
oda_logs_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda logs - Follow the logs\n"
		echo

	else
		printf "oda logs - Follow the logs\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda logs\n"
	printf "  oda logs --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda logs\n"
		echo

	fi
}

# :command.usage
oda_scaffold_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda scaffold - Generates an Odoo module skeleton in addons\n"
		echo

	else
		printf "oda scaffold - Generates an Odoo module skeleton in addons\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda scaffold MODULE\n"
	printf "  oda scaffold --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_args
		printf "%s\n" "Arguments:"

		# :argument.usage
		printf "  %s\n" "MODULE"
		printf "    Name of the module to create\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda scaffold module_ext\n"
		echo

	fi
}

# :command.usage
oda_init_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda init - initialize the database\n"
		echo

	else
		printf "oda init - initialize the database\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda init [MODULES] [OPTIONS]\n"
	printf "  oda init --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_flags
		# :flag.usage
		printf "  %s\n" "--name, -d NAME"
		printf "    Database Name\n"
		printf "    Default: $(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_args
		printf "%s\n" "Arguments:"

		# :argument.usage
		printf "  %s\n" "MODULES"
		printf "    comma seperated list of modules\n"
		printf "    Default: base,l10n_ca\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda init\n"
		echo

	fi
}

# :command.usage
oda_install_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda install - Install module(s)\n"
		echo

	else
		printf "oda install - Install module(s)\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda install MODULES [OPTIONS]\n"
	printf "  oda install --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_flags
		# :flag.usage
		printf "  %s\n" "--name, -d NAME"
		printf "    Database Name\n"
		printf "    Default: $(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_args
		printf "%s\n" "Arguments:"

		# :argument.usage
		printf "  %s\n" "MODULES"
		printf "    comma seperated list of modules\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda install base,web\n"
		echo

	fi
}

# :command.usage
oda_upgrade_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda upgrade - Upgrade module(s)\n"
		echo

	else
		printf "oda upgrade - Upgrade module(s)\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda upgrade MODULES [OPTIONS]\n"
	printf "  oda upgrade --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_flags
		# :flag.usage
		printf "  %s\n" "--name, -d NAME"
		printf "    Database Name\n"
		printf "    Default: $(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_args
		printf "%s\n" "Arguments:"

		# :argument.usage
		printf "  %s\n" "MODULES"
		printf "    comma seperated list of modules\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda upgrade base,web\n"
		echo

	fi
}

# :command.usage
oda_psql_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda psql - Access the raw database\n"
		echo

	else
		printf "oda psql - Access the raw database\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda psql [OPTIONS]\n"
	printf "  oda psql --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_flags
		# :flag.usage
		printf "  %s\n" "--host HOST"
		printf "    Database Host\n"
		printf "    Default: $(grep db_host conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--port PORT"
		printf "    Database Port\n"
		printf "    Default: $(grep db_port conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--user USERNAME"
		printf "    Username\n"
		printf "    Default: $(grep db_user conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--pass PASS"
		printf "    Password\n"
		printf "    Default: $(grep db_pass conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--name NAME"
		printf "    Database Name\n"
		printf "    Default: $(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda psql\n"
		echo

	fi
}

# :command.usage
oda_backup_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda backup - Backup database filestore and addons\n"
		echo

	else
		printf "oda backup - Backup database filestore and addons\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda backup\n"
	printf "  oda backup --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda backup\n"
		echo

	fi
}

# :command.usage
oda_restore_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda restore - Restore database and filestore or addons\n"
		echo

	else
		printf "oda restore - Restore database and filestore or addons\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda restore FILE...\n"
	printf "  oda restore --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_args
		printf "%s\n" "Arguments:"

		# :argument.usage
		printf "  %s\n" "FILE..."
		printf "    Path to backup file\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda restore backups/2020_01_01_12_00_01_odoo.zip\n"
		printf "  oda restore backups/2020_01_01_12_00_01_odoo_addons-custom.zip\n"
		printf "  oda restore backups/2020_01_01_12_00_01_odoo.zip\n  backups/2020_01_01_12_00_01_odoo_addons-custom.zip\n"
		echo

	fi
}

# :command.usage
oda_project_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda project - Project level commands [CAUTION]\n"
		echo

	else
		printf "oda project - Project level commands [CAUTION]\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda project COMMAND\n"
	printf "  oda project [COMMAND] --help | -h\n"
	echo
	# :command.usage_commands
	printf "%s\n" "Commands:"
	printf "  %s   Create a new project specifying Odoo version, Odoo Port, PostgreSQL port\n" "init   "
	printf "  %s   Drop database and filestore [CAUTION]\n" "reset  "
	printf "  %s   Fully destroy the project and all its files [CAUTION]\n" "destroy"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

	fi
}

# :command.usage
oda_project_init_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda project init - Create a new project specifying Odoo version, Odoo Port, PostgreSQL port\n"
		echo

	else
		printf "oda project init - Create a new project specifying Odoo version, Odoo Port, PostgreSQL port\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda project init VERSION [OPORT] [PGPORT]\n"
	printf "  oda project init --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_args
		printf "%s\n" "Arguments:"

		# :argument.usage
		printf "  %s\n" "VERSION"
		printf "    Odoo Version\n"
		printf "    Allowed: 15, 16\n"
		echo

		# :argument.usage
		printf "  %s\n" "OPORT"
		printf "    Odoo Port\n"
		printf "    Default: 8069\n"
		echo

		# :argument.usage
		printf "  %s\n" "PGPORT"
		printf "    PostgreSQL Port\n"
		printf "    Default: 5432\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda project init 16\n"
		printf "  oda project init 16 8080\n"
		printf "  oda project init 16 8080 5444\n"
		echo

	fi
}

# :command.usage
oda_project_reset_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda project reset - Drop database and filestore [CAUTION]\n"
		echo

	else
		printf "oda project reset - Drop database and filestore [CAUTION]\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda project reset [OPTIONS]\n"
	printf "  oda project reset --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_flags
		# :flag.usage
		printf "  %s\n" "--host HOST"
		printf "    Database Host\n"
		printf "    Default: $(grep db_host conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--port PORT"
		printf "    Database Port\n"
		printf "    Default: $(grep db_port conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--user USERNAME"
		printf "    Username\n"
		printf "    Default: $(grep db_user conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--pass PASS"
		printf "    Password\n"
		printf "    Default: $(grep db_pass conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--name NAME"
		printf "    Database Name\n"
		printf "    Default: $(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda project reset\n"
		echo

	fi
}

# :command.usage
oda_project_destroy_usage() {
	if [[ -n $long_usage ]]; then
		printf "oda project destroy - Fully destroy the project and all its files [CAUTION]\n"
		echo

	else
		printf "oda project destroy - Fully destroy the project and all its files [CAUTION]\n"
		echo

	fi

	printf "%s\n" "Usage:"
	printf "  oda project destroy [OPTIONS]\n"
	printf "  oda project destroy --help | -h\n"
	echo

	# :command.long_usage
	if [[ -n $long_usage ]]; then
		printf "%s\n" "Options:"

		# :command.usage_flags
		# :flag.usage
		printf "  %s\n" "--host HOST"
		printf "    Database Host\n"
		printf "    Default: $(grep db_host conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--port PORT"
		printf "    Database Port\n"
		printf "    Default: $(grep db_port conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--user USERNAME"
		printf "    Username\n"
		printf "    Default: $(grep db_user conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--pass PASS"
		printf "    Password\n"
		printf "    Default: $(grep db_pass conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :flag.usage
		printf "  %s\n" "--name NAME"
		printf "    Database Name\n"
		printf "    Default: $(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')\n"
		echo

		# :command.usage_fixed_flags
		printf "  %s\n" "--help, -h"
		printf "    Show this help\n"
		echo

		# :command.usage_examples
		printf "%s\n" "Examples:"
		printf "  oda project destroy\n"
		echo

	fi
}

# :command.normalize_input
normalize_input() {
	local arg flags

	while [[ $# -gt 0 ]]; do
		arg="$1"
		if [[ $arg =~ ^(--[a-zA-Z0-9_\-]+)=(.+)$ ]]; then
			input+=("${BASH_REMATCH[1]}")
			input+=("${BASH_REMATCH[2]}")
		elif [[ $arg =~ ^(-[a-zA-Z0-9])=(.+)$ ]]; then
			input+=("${BASH_REMATCH[1]}")
			input+=("${BASH_REMATCH[2]}")
		elif [[ $arg =~ ^-([a-zA-Z0-9][a-zA-Z0-9]+)$ ]]; then
			flags="${BASH_REMATCH[1]}"
			for ((i = 0; i < ${#flags}; i++)); do
				input+=("-${flags:i:1}")
			done
		else
			input+=("$arg")
		fi

		shift
	done
}
# :command.inspect_args
inspect_args() {
	if ((${#args[@]})); then
		readarray -t sorted_keys < <(printf '%s\n' "${!args[@]}" | sort)
		echo args:
		for k in "${sorted_keys[@]}"; do echo "- \${args[$k]} = ${args[$k]}"; done
	else
		echo args: none
	fi

	if ((${#other_args[@]})); then
		echo
		echo other_args:
		echo "- \${other_args[*]} = ${other_args[*]}"
		for i in "${!other_args[@]}"; do
			echo "- \${other_args[$i]} = ${other_args[$i]}"
		done
	fi

	if ((${#deps[@]})); then
		readarray -t sorted_keys < <(printf '%s\n' "${!deps[@]}" | sort)
		echo
		echo deps:
		for k in "${sorted_keys[@]}"; do echo "- \${deps[$k]} = ${deps[$k]}"; done
	fi

}

# :command.command_functions
# :command.function
oda_start_command() {
	# src/start_command.sh
	if [ -z $ODOO_PORT ]; then
		if [[ -f ".envrc" ]]; then
			export ODOO_PORT=$(grep ODOO_PORT .envrc | awk '{print $2}' | awk -F'=' '{print $2}')
		else
			export ODOO_PORT=$(grep http_port conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')
		fi
	fi
	truncate -s 0 odoo.log
	nohup ../${POD}/odoo/odoo-bin -c conf/odoo.conf --http-port ${ODOO_PORT} > /dev/null 2>&1 & disown
}

# :command.function
oda_stop_command() {
	# src/stop_command.sh
	pkill -f "${POD}/odoo/odoo-bin"
}

# :command.function
oda_restart_command() {
	# src/restart_command.sh
	if [ -z $ODOO_PORT ]; then
		if [[ -f ".envrc" ]]; then
			export ODOO_PORT=$(grep ODOO_PORT .envrc | awk '{print $2}' | awk -F'=' '{print $2}')
		else
			export ODOO_PORT=$(grep http_port conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')
		fi
	fi
	pkill -f "${POD}/odoo/odoo-bin"
	sleep 2
	truncate -s 0 odoo.log
	nohup ../${POD}/odoo/odoo-bin -c conf/odoo.conf --http-port ${ODOO_PORT} > /dev/null 2>&1 & disown
}

# :command.function
oda_logs_command() {
	# src/logs_command.sh
	LOG=$(grep logfile conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')
	tail -f ${LOG}
}

# :command.function
oda_scaffold_command() {
	# src/scaffold_command.sh
	../${POD}/odoo/odoo-bin scaffold ${args[module]} ../${POD}/addons-custom/.
}

# :command.function
oda_init_command() {
	# src/init_command.sh
	if [ -z $ODOO_PORT ]; then
		if [[ -f ".envrc" ]]; then
			export ODOO_PORT=$(grep ODOO_PORT .envrc | awk '{print $2}' | awk -F'=' '{print $2}')
		else
			export ODOO_PORT=$(grep http_port conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')
		fi
	fi
	odoo/odoo-bin -c conf/odoo.conf --no-http --stop-after-init -d ${args[--name]} -i ${args[modules]}
	pkill -f "${POD}/odoo/odoo-bin"
	sleep 2
	truncate -s 0 odoo.log
	nohup ../${POD}/odoo/odoo-bin -c conf/odoo.conf --http-port ${ODOO_PORT} > /dev/null 2>&1 & disown

}

# :command.function
oda_install_command() {
	# src/install_command.sh
	if [ -z $ODOO_PORT ]; then
		if [[ -f ".envrc" ]]; then
			export ODOO_PORT=$(grep ODOO_PORT .envrc | awk '{print $2}' | awk -F'=' '{print $2}')
		else
			export ODOO_PORT=$(grep http_port conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')
		fi
	fi
	odoo/odoo-bin -c conf/odoo.conf --no-http --stop-after-init -d ${args[--name]} -i ${args[modules]}
	pkill -f "${POD}/odoo/odoo-bin"
	sleep 2
	truncate -s 0 odoo.log
	nohup ../${POD}/odoo/odoo-bin -c conf/odoo.conf --http-port ${ODOO_PORT} > /dev/null 2>&1 & disown

}

# :command.function
oda_upgrade_command() {
	# src/upgrade_command.sh
	if [ -z $ODOO_PORT ]; then
		if [[ -f ".envrc" ]]; then
			export ODOO_PORT=$(grep ODOO_PORT .envrc | awk '{print $2}' | awk -F'=' '{print $2}')
		else
			export ODOO_PORT=$(grep http_port conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')
		fi
	fi
	odoo/odoo-bin -c conf/odoo.conf --no-http --stop-after-init -d ${args[--name]} -u ${args[modules]}
	pkill -f "${POD}/odoo/odoo-bin"
	sleep 2
	truncate -s 0 odoo.log
	nohup ../${POD}/odoo/odoo-bin -c conf/odoo.conf --http-port ${ODOO_PORT} > /dev/null 2>&1 & disown

}

# :command.function
oda_psql_command() {
	# src/psql_command.sh
	psql postgres://${args[--user]}:${args[--pass]}@${args[--host]}:${args[--port]}/${args[--name]}
}

# :command.function
oda_backup_command() {
	# src/backup_command.sh
	BASE=`dirname "${0}"`
	python3 -B ${BASE}/oda_db.py -b
}

# :command.function
oda_restore_command() {
	# src/restore_command.sh
	BASE=`dirname "${0}"`
	for bfile in ${args[file]}
	do
		python3 -B ${BASE}/oda_db.py -r -d "${bfile}"
	done
}

# :command.function
oda_project_init_command() {
	# src/project_init_command.sh
	function envrc(){
	[ -z ${2} ] && export PORT=8069 || export PORT=${2}
	cat <<-_EOF_ | tee .envrc > /dev/null
	layout python3
	export ODOO_V=${1}.0
	export ODOO_PORT=${PORT}
	export ODOO_C=${HOME}/workspace/repos/${1}.0/odoo
	export ODOO_E=${HOME}/workspace/repos/${1}.0/enterprise
	_EOF_
	}

	function configfile(){
	cat <<-_EOF_ | tee conf/odoo.conf > /dev/null
	[options]
	addons_path = ./odoo/addons,./enterprise,./addons-purchased,./addons-custom
	admin_passwd = adminadmin
	without_demo = all
	csv_internal_sep = ;
	data_dir = ./data
	db_host = ${IPV4}
	db_port = 5432
	db_maxconn = 24
	db_user = odoo${1}
	db_password = odooodoo
	db_name = ${POD}
	db_template = template0
	db_sslmode = disable
	list_db = False
	workers = 4
	max_cron_threads = 2
	http_enable = True
	http_interface =
	http_port = 8069
	reportgz = False
	server_wide_modules = base,web
	logfile = ./odoo.log
	log_level = debug
	logrotate = True
	# log_handler = werkzeug:CRITICAL,odoo.api:DEBUG
	# log_db_level = warning
	_EOF_
	}

	function pipfile(){
	cat <<-_EOF_ | tee Pipfile > /dev/null
	[[source]]
	url = "https://pypi.org/simple"
	verify_ssl = true
	name = "pypi"

	[packages]
	babel = "==2.9.1"
	chardet = "==3.0.4"
	cryptography = "==2.6.1"
	decorator = "==4.4.2"
	docutils = "==0.16"
	ebaysdk = "==2.1.5"
	freezegun = "==0.3.15"
	gevent = "==21.8.0"
	google-auth = "==2.17.*"
	greenlet = "==1.1.*"
	idna = "==2.8"
	jinja2 = "==2.11.3"
	libsass = "==0.18.0"
	lxml = "==4.6.5"
	markupsafe = "==1.1.0"
	num2words = "==0.5.6"
	ofxparse = "==0.21"
	passlib = "==1.7.3"
	pillow = "==9.0.1"
	polib = "==1.1.0"
	"pdfminer.six" = "*"
	psutil = "==5.6.7"
	psycopg2-binary = "2.9.5"
	pydot = "==1.4.1"
	pyopenssl = "==19.0.0"
	pypdf2 = "==1.26.0"
	pyserial = "==3.4"
	python-dateutil = "==2.8.2"
	python-stdnum = "==1.13"
	pytz = "*"
	pyusb = "==1.0.2"
	qrcode = "==6.1"
	reportlab = "==3.5.59"
	requests = "==2.25.1"
	urllib3 = "==1.26.5"
	vobject = "==0.9.6.1"
	werkzeug = "==2.0.3"
	xlrd = "==1.2.0"
	xlsxwriter = "==1.1.2"
	xlwt = "==1.3.*"
	zeep = "==3.4.0"
	paramiko = "==2.12.0"

	[dev-packages]
	yapf="*"
	pylint="*"
	pylint-odoo="*"

	[requires]
	python_version = "3"
	_EOF_
	}

	envrc ${args[version]} ${args[oport]}
	direnv allow >/dev/null
	mkdir -p conf data backups addons-custom addons-purchased
	ODOO_C=$(grep ODOO_C .envrc | awk '{print $2}' | awk -F'=' '{print $2}')
	ODOO_E=$(grep ODOO_E .envrc | awk '{print $2}' | awk -F'=' '{print $2}')
	if [ -L "odoo" ]; then rm -f odoo ; fi
	ln -f -s ${ODOO_C} odoo
	if [ -L "enterprise" ]; then rm -f enterprise ; fi
	ln -f -s ${ODOO_E} enterprise
	configfile ${args[version]}
	pipfile
	printf "To install python dev dependencies run:\npipenv install --dev\n\n"
}

# :command.function
oda_project_reset_command() {
	# src/project_reset_command.sh
	read -r -p "Are you sure you want to reset the database? [YES/N] " response
	if [[ "$response" =~ ^(YES)$ ]]; then
		read -r -p "Are you **really** sure you want to reset the database? [YES/N] " response
		if [[ "$response" =~ ^(YES)$ ]]; then
			echo "Resetting project"
			trap "pkill -f ${POD}/odoo/odoo-bin" SIGINT
			rm -rf data/* > /dev/null
			PGPASSWORD=${args[--pass]} dropdb -U ${args[--user]} -h ${args[--host]} -p ${args[--port]} -w -f ${args[--name]} >/dev/null
			echo "Project reset"
		fi
	fi
}

# :command.function
oda_project_destroy_command() {
	# src/project_destroy_command.sh
	read -r -p "Are you sure you want to destroy everything? [YES/N] " response
	if [[ "$response" =~ ^(YES)$ ]]; then
		read -r -p "Are you **really** sure you want to destroy everything? [YES/N] " response
		if [[ "$response" =~ ^(YES)$ ]]; then
			echo "Destroying project"
			trap "pkill -f ${POD}/odoo/odoo-bin" SIGINT
			rm -rf .direnv/ .envrc *
			PGPASSWORD=${args[--pass]} dropdb -U ${args[--user]} -h ${args[--host]} -p ${args[--port]} -w -f ${args[--name]} >/dev/null
			echo "Project has been destroyed"
		fi
	fi
}

# :command.parse_requirements
parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--version | -v)
				version_command
				exit
				;;

			--help | -h)
				long_usage=yes
				oda_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.environment_variables_filter
	# :command.environment_variables_default
	export POD="${POD:-${PWD##*/}}"

	# :command.command_filter
	action=${1:-}

	case $action in
		-*) ;;

		start)
			action="start"
			shift
			oda_start_parse_requirements "$@"
			shift $#
			;;

		stop)
			action="stop"
			shift
			oda_stop_parse_requirements "$@"
			shift $#
			;;

		restart)
			action="restart"
			shift
			oda_restart_parse_requirements "$@"
			shift $#
			;;

		logs)
			action="logs"
			shift
			oda_logs_parse_requirements "$@"
			shift $#
			;;

		scaffold)
			action="scaffold"
			shift
			oda_scaffold_parse_requirements "$@"
			shift $#
			;;

		init)
			action="init"
			shift
			oda_init_parse_requirements "$@"
			shift $#
			;;

		install)
			action="install"
			shift
			oda_install_parse_requirements "$@"
			shift $#
			;;

		upgrade)
			action="upgrade"
			shift
			oda_upgrade_parse_requirements "$@"
			shift $#
			;;

		psql)
			action="psql"
			shift
			oda_psql_parse_requirements "$@"
			shift $#
			;;

		backup)
			action="backup"
			shift
			oda_backup_parse_requirements "$@"
			shift $#
			;;

		restore)
			action="restore"
			shift
			oda_restore_parse_requirements "$@"
			shift $#
			;;

		project)
			action="project"
			shift
			oda_project_parse_requirements "$@"
			shift $#
			;;

		# :command.command_fallback
		"")
			oda_usage >&2
			exit 1
			;;

		*)
			printf "invalid command: %s\n" "$action" >&2
			exit 1
			;;

	esac

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				printf "invalid argument: %s\n" "$key" >&2
				exit 1

				;;

		esac
	done

}

# :command.parse_requirements
oda_start_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_start_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="start"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				printf "invalid argument: %s\n" "$key" >&2
				exit 1

				;;

		esac
	done

}

# :command.parse_requirements
oda_stop_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_stop_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="stop"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				printf "invalid argument: %s\n" "$key" >&2
				exit 1

				;;

		esac
	done

}

# :command.parse_requirements
oda_restart_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_restart_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="restart"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				printf "invalid argument: %s\n" "$key" >&2
				exit 1

				;;

		esac
	done

}

# :command.parse_requirements
oda_logs_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_logs_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="logs"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				printf "invalid argument: %s\n" "$key" >&2
				exit 1

				;;

		esac
	done

}

# :command.parse_requirements
oda_scaffold_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_scaffold_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="scaffold"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				if [[ -z ${args['module']+x} ]]; then

					args['module']=$1
					shift
				else
					printf "invalid argument: %s\n" "$key" >&2
					exit 1
				fi

				;;

		esac
	done

	# :command.required_args_filter
	if [[ -z ${args['module']+x} ]]; then
		printf "missing required argument: MODULE\nusage: oda scaffold MODULE\n" >&2
		exit 1
	fi

}

# :command.parse_requirements
oda_init_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_init_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="init"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in
			# :flag.case
			--name | -d)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--name']="$2"
					shift
					shift
				else
					printf "%s\n" "--name requires an argument: --name, -d NAME" >&2
					exit 1
				fi
				;;

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				if [[ -z ${args['modules']+x} ]]; then

					args['modules']=$1
					shift
				else
					printf "invalid argument: %s\n" "$key" >&2
					exit 1
				fi

				;;

		esac
	done

	# :command.default_assignments
	[[ -n ${args['modules']:-} ]] || args['modules']="base,l10n_ca"
	[[ -n ${args['--name']:-} ]] || args['--name']="$(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"

}

# :command.parse_requirements
oda_install_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_install_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="install"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in
			# :flag.case
			--name | -d)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--name']="$2"
					shift
					shift
				else
					printf "%s\n" "--name requires an argument: --name, -d NAME" >&2
					exit 1
				fi
				;;

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				if [[ -z ${args['modules']+x} ]]; then

					args['modules']=$1
					shift
				else
					printf "invalid argument: %s\n" "$key" >&2
					exit 1
				fi

				;;

		esac
	done

	# :command.required_args_filter
	if [[ -z ${args['modules']+x} ]]; then
		printf "missing required argument: MODULES\nusage: oda install MODULES [OPTIONS]\n" >&2
		exit 1
	fi

	# :command.default_assignments
	[[ -n ${args['--name']:-} ]] || args['--name']="$(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"

}

# :command.parse_requirements
oda_upgrade_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_upgrade_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="upgrade"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in
			# :flag.case
			--name | -d)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--name']="$2"
					shift
					shift
				else
					printf "%s\n" "--name requires an argument: --name, -d NAME" >&2
					exit 1
				fi
				;;

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				if [[ -z ${args['modules']+x} ]]; then

					args['modules']=$1
					shift
				else
					printf "invalid argument: %s\n" "$key" >&2
					exit 1
				fi

				;;

		esac
	done

	# :command.required_args_filter
	if [[ -z ${args['modules']+x} ]]; then
		printf "missing required argument: MODULES\nusage: oda upgrade MODULES [OPTIONS]\n" >&2
		exit 1
	fi

	# :command.default_assignments
	[[ -n ${args['--name']:-} ]] || args['--name']="$(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"

}

# :command.parse_requirements
oda_psql_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_psql_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="psql"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in
			# :flag.case
			--host)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--host']="$2"
					shift
					shift
				else
					printf "%s\n" "--host requires an argument: --host HOST" >&2
					exit 1
				fi
				;;

			# :flag.case
			--port)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--port']="$2"
					shift
					shift
				else
					printf "%s\n" "--port requires an argument: --port PORT" >&2
					exit 1
				fi
				;;

			# :flag.case
			--user)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--user']="$2"
					shift
					shift
				else
					printf "%s\n" "--user requires an argument: --user USERNAME" >&2
					exit 1
				fi
				;;

			# :flag.case
			--pass)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--pass']="$2"
					shift
					shift
				else
					printf "%s\n" "--pass requires an argument: --pass PASS" >&2
					exit 1
				fi
				;;

			# :flag.case
			--name)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--name']="$2"
					shift
					shift
				else
					printf "%s\n" "--name requires an argument: --name NAME" >&2
					exit 1
				fi
				;;

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				printf "invalid argument: %s\n" "$key" >&2
				exit 1

				;;

		esac
	done

	# :command.default_assignments
	[[ -n ${args['--host']:-} ]] || args['--host']="$(grep db_host conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--port']:-} ]] || args['--port']="$(grep db_port conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--user']:-} ]] || args['--user']="$(grep db_user conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--pass']:-} ]] || args['--pass']="$(grep db_pass conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--name']:-} ]] || args['--name']="$(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"

}

# :command.parse_requirements
oda_backup_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_backup_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="backup"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				printf "invalid argument: %s\n" "$key" >&2
				exit 1

				;;

		esac
	done

}

# :command.parse_requirements
oda_restore_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_restore_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="restore"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_repeatable

				if [[ -z ${args['file']+x} ]]; then
					args['file']="\"$1\""
					shift
				else
					args['file']="${args[file]} \"$1\""
					shift
				fi

				;;

		esac
	done

	# :command.required_args_filter
	if [[ -z ${args['file']+x} ]]; then
		printf "missing required argument: FILE\nusage: oda restore FILE...\n" >&2
		exit 1
	fi

}

# :command.parse_requirements
oda_project_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_project_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action=${1:-}

	case $action in
		-*) ;;

		init)
			action="init"
			shift
			oda_project_init_parse_requirements "$@"
			shift $#
			;;

		reset)
			action="reset"
			shift
			oda_project_reset_parse_requirements "$@"
			shift $#
			;;

		destroy)
			action="destroy"
			shift
			oda_project_destroy_parse_requirements "$@"
			shift $#
			;;

		# :command.command_fallback
		"")
			oda_project_usage >&2
			exit 1
			;;

		*)
			printf "invalid command: %s\n" "$action" >&2
			exit 1
			;;

	esac

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				printf "invalid argument: %s\n" "$key" >&2
				exit 1

				;;

		esac
	done

}

# :command.parse_requirements
oda_project_init_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_project_init_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.environment_variables_filter
	# :command.environment_variables_default
	export IPV4="${IPV4:-$(ip -4 -br a show | grep -v ^lo | grep UP | awk '{print $3}' | awk -F'/' '{print $1}')}"

	# :command.command_filter
	action="project init"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				if [[ -z ${args['version']+x} ]]; then

					args['version']=$1
					shift
				elif [[ -z ${args['oport']+x} ]]; then

					args['oport']=$1
					shift
				elif [[ -z ${args['pgport']+x} ]]; then

					args['pgport']=$1
					shift
				else
					printf "invalid argument: %s\n" "$key" >&2
					exit 1
				fi

				;;

		esac
	done

	# :command.required_args_filter
	if [[ -z ${args['version']+x} ]]; then
		printf "missing required argument: VERSION\nusage: oda project init VERSION [OPORT] [PGPORT]\n" >&2
		exit 1
	fi

	# :command.default_assignments
	[[ -n ${args['oport']:-} ]] || args['oport']="8069"
	[[ -n ${args['pgport']:-} ]] || args['pgport']="5432"

	# :command.whitelist_filter
	if [[ -n ${args['version']} ]] && [[ ! ${args['version']} =~ ^(15|16)$ ]]; then
		printf "%s\n" "version must be one of: 15, 16" >&2
		exit 1
	fi

}

# :command.parse_requirements
oda_project_reset_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_project_reset_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="project reset"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in
			# :flag.case
			--host)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--host']="$2"
					shift
					shift
				else
					printf "%s\n" "--host requires an argument: --host HOST" >&2
					exit 1
				fi
				;;

			# :flag.case
			--port)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--port']="$2"
					shift
					shift
				else
					printf "%s\n" "--port requires an argument: --port PORT" >&2
					exit 1
				fi
				;;

			# :flag.case
			--user)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--user']="$2"
					shift
					shift
				else
					printf "%s\n" "--user requires an argument: --user USERNAME" >&2
					exit 1
				fi
				;;

			# :flag.case
			--pass)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--pass']="$2"
					shift
					shift
				else
					printf "%s\n" "--pass requires an argument: --pass PASS" >&2
					exit 1
				fi
				;;

			# :flag.case
			--name)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--name']="$2"
					shift
					shift
				else
					printf "%s\n" "--name requires an argument: --name NAME" >&2
					exit 1
				fi
				;;

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				printf "invalid argument: %s\n" "$key" >&2
				exit 1

				;;

		esac
	done

	# :command.default_assignments
	[[ -n ${args['--host']:-} ]] || args['--host']="$(grep db_host conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--port']:-} ]] || args['--port']="$(grep db_port conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--user']:-} ]] || args['--user']="$(grep db_user conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--pass']:-} ]] || args['--pass']="$(grep db_pass conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--name']:-} ]] || args['--name']="$(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"

}

# :command.parse_requirements
oda_project_destroy_parse_requirements() {
	# :command.fixed_flags_filter
	while [[ $# -gt 0 ]]; do
		case "${1:-}" in
			--help | -h)
				long_usage=yes
				oda_project_destroy_usage
				exit
				;;

			*)
				break
				;;

		esac
	done

	# :command.command_filter
	action="project destroy"

	# :command.parse_requirements_while
	while [[ $# -gt 0 ]]; do
		key="$1"
		case "$key" in
			# :flag.case
			--host)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--host']="$2"
					shift
					shift
				else
					printf "%s\n" "--host requires an argument: --host HOST" >&2
					exit 1
				fi
				;;

			# :flag.case
			--port)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--port']="$2"
					shift
					shift
				else
					printf "%s\n" "--port requires an argument: --port PORT" >&2
					exit 1
				fi
				;;

			# :flag.case
			--user)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--user']="$2"
					shift
					shift
				else
					printf "%s\n" "--user requires an argument: --user USERNAME" >&2
					exit 1
				fi
				;;

			# :flag.case
			--pass)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--pass']="$2"
					shift
					shift
				else
					printf "%s\n" "--pass requires an argument: --pass PASS" >&2
					exit 1
				fi
				;;

			# :flag.case
			--name)

				# :flag.case_arg
				if [[ -n ${2+x} ]]; then

					args['--name']="$2"
					shift
					shift
				else
					printf "%s\n" "--name requires an argument: --name NAME" >&2
					exit 1
				fi
				;;

			-?*)
				printf "invalid option: %s\n" "$key" >&2
				exit 1
				;;

			*)
				# :command.parse_requirements_case
				# :command.parse_requirements_case_simple
				printf "invalid argument: %s\n" "$key" >&2
				exit 1

				;;

		esac
	done

	# :command.default_assignments
	[[ -n ${args['--host']:-} ]] || args['--host']="$(grep db_host conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--port']:-} ]] || args['--port']="$(grep db_port conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--user']:-} ]] || args['--user']="$(grep db_user conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--pass']:-} ]] || args['--pass']="$(grep db_pass conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"
	[[ -n ${args['--name']:-} ]] || args['--name']="$(grep db_name conf/odoo.conf | awk -F'=' '{print $2}' | tr -d '[:space:]')"

}

# :command.initialize
initialize() {
	version="0.1.0"
	long_usage=''
	set -e

	# :command.environment_variables_default
	export POD="${POD:-${PWD##*/}}"

}

# :command.run
run() {
	declare -A args=()
	declare -A deps=()
	declare -a other_args=()
	declare -a input=()
	normalize_input "$@"
	parse_requirements "${input[@]}"

	case "$action" in
		"start") oda_start_command ;;
		"stop") oda_stop_command ;;
		"restart") oda_restart_command ;;
		"logs") oda_logs_command ;;
		"scaffold") oda_scaffold_command ;;
		"init") oda_init_command ;;
		"install") oda_install_command ;;
		"upgrade") oda_upgrade_command ;;
		"psql") oda_psql_command ;;
		"backup") oda_backup_command ;;
		"restore") oda_restore_command ;;
		"project") oda_project_command ;;
		"project init") oda_project_init_command ;;
		"project reset") oda_project_reset_command ;;
		"project destroy") oda_project_destroy_command ;;
	esac
}

initialize
run "$@"
